name: .NET build artifacts

on:
  workflow_dispatch:
env:
  DOTNET_VERSION: '9.0.301'
  NUGET_BINARY_VERSION: '6.13.2'

jobs:
  BuildAndTest:
    name: "Build and Create IOM"
    runs-on: windows-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        path: main

    - name: 'Setup msbuild'
      uses: microsoft/setup-msbuild@v1

    - name: 'Setup .NET SDK'
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: 'Setup nuget.exe'
      uses: NuGet/setup-nuget@v1
      with:
        nuget-version: ${{ env.NUGET_BINARY_VERSION }}

    - name: Nuget restore dependencies
      run: nuget restore ./src/api-sdks/ClientExamples.sln
      working-directory: main

    - name: Build
      run: msbuild ./src/api-sdks/ClientExamples.sln /p:Configuration=Release
      working-directory: main

    - name: 'Upload ConApiWpfClientApp'
      uses: actions/upload-artifact@v4
      with:
        name: ConApiWpfClientApp
        path: ${{ github.workspace }}/main/src/api-sdks/connection-api/clients/csharp/examples/ConApiWpfClient/ConApiWpfClientApp/bin/Release/net6.0-windows
        if-no-files-found: error

    - name: 'Upload RcsApiWpfClientApp'
      uses: actions/upload-artifact@v4
      with:
        name: RcsApiWpfClientApp
        path: ${{ github.workspace }}/main/src/api-sdks/rcs-api/clients/csharp/examples/RcsApiWpfClient/RcsApiWpfClientApp/bin/Release/net6.0-windows
        if-no-files-found: error
